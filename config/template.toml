# Configuration file for a single run. All comments are in English.
# Max line length is 88 chars. Each parameter is documented above its key.
# This file can be copied and adapted for each site or experiment.

[site]
# Human readable site name.
name = "Example Site"
# Latitude in decimal degrees (south negative).
latitude_deg = -75.10
# Longitude in decimal degrees (east positive).
longitude_deg = 123.35
# Elevation above mean sea level in meters.
elevation_m = 3233

[calibration]
# Additive bias for measured azimuth in degrees (applied to real measurements).
az_bias_deg = 0.0
# Additive bias for measured elevation in degrees (applied to real measurements).
el_bias_deg = 0.0
# Azimuth convention. Use "north_cw" for 0..360 from geographic north clockwise.
az_convention = "north_cw"
# Wrap range for azimuth normalization in degrees, typically 360.0 or 0.0 to disable.
wrap_az_deg = 360.0

[input]
# Root folder where raw map files and environment.tsv are located.
data_dir = "data"
# Glob pattern (relative to data_dir) to discover map files.
# Example for FITS maps: "**/*.fits"
map_glob = "**/*.*"
# File name of the per-sample environment file inside data_dir.
environment_file = "environment.tsv"

[processing]
# Time selection mode for computing the ideal Sun position.
# "median-subscan": use median time of the strongest sub-scan.
# "gaussian-peak": use time at the 2D Gaussian peak position.
time_mode = "gaussian-peak"

[processing.time_inference]
# Strategy to infer the peak timestamp from encoder space.
# "single:<method>": use one method only (e.g., "single:bilinear").
# "best": compute all listed methods and pick the one with lowest spatial residual.
# "consensus": average times only if spread is within max_time_spread_s; else use best.
strategy = "consensus"
# Methods available: "nearest", "bilinear", "knn-regression".
methods = ["nearest", "bilinear"]
# Maximum allowed spread in seconds between methods to accept consensus.
max_time_spread_s = 5.0
# Number of neighbors for KNN regression (used only if listed in methods).
knn_k = 6
# Maximum spatial residual in degrees to accept a candidate solution.
max_spatial_residual_deg = 0.05

[ephemeris]
# Backend for solar ephemerides: "astropy" or "pysolar".
backend = "astropy"
# Refraction mode: "none" (no refraction) or "apparent" (atmospheric refraction on).
refraction = "apparent"
# Default pressure in hPa if environment.tsv is absent or fields are missing.
pressure_hPa = 680.0
# Default temperature in Celsius if environment.tsv is absent or fields are missing.
temperature_C = -30.0

[environment]
# Optional per-sample environment file in the data folder. When present, the given
# columns override ephemeris defaults on a per-row basis.
# Timestamp column name containing ISO8601 times (e.g., 2025-01-03T00:02:35Z).
ts_column = "timestamp"
# Column name for pressure in hPa. If absent, defaults remain in effect.
pressure_column = "pressure_hPa"
# Column name for temperature in Celsius. If absent, defaults remain in effect.
temperature_column = "temperature_C"
# Column name for opacity (tau). Optional and not used by all algorithms.
tau_column = "tau_225"
# Token that denotes a missing value in the environment file.
missing_token = "none"

[algo.gauss2d]
# Half window size in pixels around the detected peak for the 2D Gaussian fit.
fit_window_pix = 5
# Standard deviation of the smoothing kernel in pixels applied before peak finding.
smooth_sigma_pix = 1.0
# Minimum signal to noise ratio of the peak to accept a detection.
peak_min_snr = 3.0
# Background removal method: "none", "median", or "plane".
background_subtraction = "median"
# Enable robust fitting to reduce the impact of outliers.
robust_fit = true
# Maximum number of iterations of the non linear optimizer.
max_iter = 50

[output]
# Output TSV file path for offsets. Relative paths are resolved from run directory.
out_tsv = "output/offsets/offsets.tsv"
# Write time uncertainty columns to the output TSV when available.
write_time_uncertainty = true
# Verbose logging for debugging and inspection.
verbose = true
